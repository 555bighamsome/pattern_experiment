<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
    <title>Pattern DSL - Free Play</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        /* Free Play specific styles */
        .gallery-card {
            grid-area: target;
            display: flex;
            flex-direction: column;
            background-color: #1e293b;
            border: 1px solid #334155;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
            flex: 1;
        }

        .gallery-item {
            aspect-ratio: 1;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s, border-color 0.2s;
        }

        .gallery-item:hover {
            transform: scale(1.05);
            border-color: #3b82f6;
        }

        .gallery-item canvas {
            width: 100%;
            height: 100%;
            border-radius: 3px;
        }

        .gallery-empty {
            grid-column: 1 / -1;
            text-align: center;
            color: #64748b;
            padding: 20px;
            font-style: italic;
        }

        .freeplay-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: #1e293b;
            border-bottom: 1px solid #334155;
            margin-bottom: 20px;
        }

        .freeplay-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e2e8f0;
        }

        .freeplay-actions {
            display: flex;
            gap: 10px;
        }

        /* Achievement animation */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .achievement-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 1000;
            pointer-events: none;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.27) forwards;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body class="dark-page">
    <div id="experimentContent">
        <div class="freeplay-header">
            <div class="freeplay-title">âœ¨ Creative Mode</div>
            <div class="freeplay-actions">
                <button class="btn btn-warning" onclick="finishFreePlay()">
                    Finish Session & Download Data
                </button>
            </div>
        </div>

        <div class="content-area">
            <!-- Reusing points card for session stats -->
            <div class="points-card" id="statsCard">
                <div class="points-label">Creations</div>
                <div class="points-value" id="galleryCount">0</div>
            </div>

            <div id="binaryPreviewPanel" class="panel-card preview-card binary-preview-panel">
                <h3 class="panel-title">PREVIEW</h3>
                <div class="binary-preview-header is-hidden">
                    <div id="binaryPreviewTitle" class="binary-preview-title"></div>
                </div>
                <div id="binaryPreviewPlaceholder" class="binary-preview-placeholder">Select an operation to get started</div>
                <div id="binaryPreviewBody" class="binary-preview-body" style="display:none;">
                    <div id="binaryInlineOpLabel" class="binary-inline-op">add(</div>
                    <div id="binaryOperandA" class="operand-box"></div>
                    <div class="binary-inline-comma">,</div>
                    <div id="binaryOperandB" class="operand-box"></div>
                    <div class="binary-inline-close">)</div>
                </div>
                <div id="unaryPreviewBody" class="binary-preview-body unary-preview-body" style="display:none;">
                    <div id="unaryInlineOpLabel" class="binary-inline-op">invert(</div>
                    <div id="unaryOperandBox" class="operand-box"></div>
                    <div class="binary-inline-close">)</div>
                </div>
                <div class="binary-preview-footer">
                    <button id="binaryResetBtn" class="btn btn-warning binary-cancel-btn" onclick="resetPendingOperation()" disabled>
                        âŸ² Reset
                    </button>
                    <button id="binaryConfirmBtn" class="btn btn-success binary-confirm-btn" onclick="confirmPendingOperation()" disabled>
                        âœ“ Confirm
                    </button>
                </div>
            </div>

            <!-- Replaced Target Pattern with Gallery -->
            <div class="panel-card gallery-card">
                <h3 class="panel-title">MY GALLERY</h3>
                <div id="galleryGrid" class="gallery-grid">
                    <div class="gallery-empty">Your saved creations will appear here</div>
                </div>
            </div>

            <div class="panel-card pattern-card">
                <h3 class="panel-title">YOUR CANVAS</h3>
                <div class="workspace-canvas" id="workspace"></div>
            </div>

            <div class="panel-card controls-card">
                <div class="controls-section operations-section">
                    <h4 class="panel-subtitle">OPERATIONS</h4>
                    <div class="section-panel">
                    <div class="operations-grid">
                        <button id="bin-add" data-op="add" class="transform-btn binary-btn" onclick="selectBinaryOp('add')" title="Add/OR two patterns">
                            <span class="btn-text">add</span>
                        </button>
                        <button id="bin-subtract" data-op="subtract" class="transform-btn binary-btn" onclick="selectBinaryOp('subtract')" title="Subtract one pattern from another">
                            <span class="btn-text">subtract</span>
                        </button>
                        <button id="bin-union" data-op="union" class="transform-btn binary-btn" onclick="selectBinaryOp('union')" title="Union/AND two patterns">
                            <span class="btn-text">union</span>
                        </button>
                        <button class="transform-btn unary-btn" data-op="invert" onclick="applyTransform('invert')" title="Invert pattern (flip black/white)">
                            <span class="btn-text">invert</span>
                        </button>
                        <button class="transform-btn unary-btn" data-op="reflect_horizontal" onclick="applyTransform('reflect_horizontal')" title="Reflect horizontally - top âŸ· bottom">
                            <span class="btn-arrow">â‡µ</span>
                            <span class="btn-text">flip_h</span>
                        </button>
                        <button class="transform-btn unary-btn" data-op="reflect_vertical" onclick="applyTransform('reflect_vertical')" title="Reflect vertically - left âŸ· right">
                            <span class="btn-arrow">â‡„</span>
                            <span class="btn-text">flip_v</span>
                        </button>
                        <button class="transform-btn unary-btn" data-op="reflect_diag" onclick="applyTransform('reflect_diag')" title="Reflect diagonally">
                            <span class="btn-arrow">â¤¢</span>
                            <span class="btn-text">flip_d</span>
                        </button>
                    </div>
                    </div>
                </div>
                <div class="controls-section primitives-section">
                    <h4 class="panel-subtitle">PRIMITIVES</h4>
                    <div class="section-panel">
                    <div class="primitives-grid-inline">
                        <button class="primitive-btn" data-op="blank" onclick="applyPrimitive('blank')" title="Create blank pattern">
                            <span class="btn-icon"></span>
                        </button>
                        <button class="primitive-btn" data-op="line_horizontal" onclick="applyPrimitive('line_horizontal')" title="Horizontal line">
                            <span class="btn-icon"></span>
                        </button>
                        <button class="primitive-btn" data-op="line_vertical" onclick="applyPrimitive('line_vertical')" title="Vertical line">
                            <span class="btn-icon"></span>
                        </button>
                        <button class="primitive-btn" data-op="diagonal" onclick="applyPrimitive('diagonal')" title="Diagonal line">
                            <span class="btn-icon"></span>
                        </button>
                        <button class="primitive-btn" data-op="square" onclick="applyPrimitive('square')" title="Square shape">
                            <span class="btn-icon"></span>
                        </button>
                        <button class="primitive-btn" data-op="triangle" onclick="applyPrimitive('triangle')" title="Triangle shape">
                            <span class="btn-icon"></span>
                        </button>
                    </div>
                    </div>
                </div>
                <div class="controls-section helpers-section">
                    <div class="helpers-header-row">
                        <h4 class="panel-subtitle">YOUR HELPERS</h4>
                    </div>
                    <div class="section-panel helpers-panel">
                        <div id="favoritesShelf" class="helpers-grid">
                            <div class="helpers-empty">Favorite a step to reuse it here.</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-card program-card">
                <div class="program-header">
                    <h4 class="panel-subtitle">STEP SEQUENCE</h4>
                    <button class="btn btn-primary program-submit" onclick="saveToGallery()" title="Save your creation to the gallery">
                        <span style="font-size:1.1rem; margin-right:0.2rem;">ðŸ“·</span> Save to Gallery
                    </button>
                </div>
                <div class="operations-log" id="operationsLog">
                    <span style="color: #9ca3af; font-size: 0.85rem;">Waiting for operations...</span>
                </div>
            </div>
        </div>

        <!-- Achievement Toast Container -->
        <div id="achievementContainer"></div>
    </div>

    <script type="module" src="../js/freeplay.js"></script>
</body>
</html>
